<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ReelRoulette"
        x:Class="ReelRoulette.SettingsDialog"
        x:DataType="local:SettingsDialog"
        Title="Settings"
        Width="600"
        Height="500"
        WindowStartupLocation="CenterOwner"
        MinWidth="500"
        MinHeight="400">
    <Grid RowDefinitions="* Auto" Margin="12">
        <!-- Tab Control -->
        <TabControl Grid.Row="0" Margin="0,0,0,16">
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="20" Margin="12">
                        <!-- Library Backup Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Library Backup" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <CheckBox Content="Backup Library?"
                                      IsChecked="{Binding BackupLibraryEnabled}"/>
                            <Grid ColumnDefinitions="Auto * Auto" ColumnSpacing="8" Margin="20,4,0,4">
                                <TextBlock Grid.Column="0" 
                                           Text="Minimum Backup Gap (minutes):" 
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Grid.Column="1"
                                               x:Name="MinimumBackupGapNumericUpDown"
                                               Value="{Binding MinimumBackupGapMinutes}"
                                               Minimum="1"
                                               Maximum="60"
                                               FormatString="0"
                                               Increment="1"
                                               ShowButtonSpinner="True"
                                               HorizontalAlignment="Left"
                                               Width="150"/>
                                <TextBlock Grid.Column="2"
                                           Text="(1-60)"
                                           VerticalAlignment="Center"
                                           Foreground="Gray"
                                           FontSize="12"/>
                            </Grid>
                            <Grid ColumnDefinitions="Auto * Auto" ColumnSpacing="8" Margin="20,4,0,4">
                                <TextBlock Grid.Column="0" 
                                           Text="Number of Backups:" 
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Grid.Column="1"
                                               x:Name="NumberOfBackupsNumericUpDown"
                                               Value="{Binding NumberOfBackups}"
                                               Minimum="1"
                                               Maximum="30"
                                               FormatString="0"
                                               Increment="1"
                                               ShowButtonSpinner="True"
                                               HorizontalAlignment="Left"
                                               Width="150"/>
                                <TextBlock Grid.Column="2"
                                           Text="(1-30)"
                                           VerticalAlignment="Center"
                                           Foreground="Gray"
                                           FontSize="12"/>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Playback Tab -->
            <TabItem Header="Playback">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="20" Margin="12">
                        <!-- Playback Behavior Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Playback Behavior" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <CheckBox Content="Loop current video"
                                      IsChecked="{Binding LoopEnabled}"/>
                            <CheckBox Content="Auto-play next video"
                                      IsChecked="{Binding AutoPlayNext}"/>
                            <CheckBox Content="No repeats until all played"
                                      IsChecked="{Binding NoRepeatMode}"/>
                        </StackPanel>
                        
                        <!-- Timer Interval Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Timer Interval" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <Grid ColumnDefinitions="Auto * Auto" ColumnSpacing="8">
                                <TextBlock Grid.Column="0" 
                                           Text="Interval (seconds):" 
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Grid.Column="1"
                                               x:Name="TimerIntervalNumericUpDown"
                                               Value="{Binding TimerIntervalSeconds}"
                                               Minimum="1"
                                               Maximum="3600"
                                               FormatString="0"
                                               Increment="1"
                                               ShowButtonSpinner="True"
                                               HorizontalAlignment="Left"
                                               Width="150"/>
                                <TextBlock Grid.Column="2"
                                           Text="(1-3600)"
                                           VerticalAlignment="Center"
                                           Foreground="Gray"
                                           FontSize="12"/>
                            </Grid>
                        </StackPanel>

                        <!-- Photo Display Duration Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Photo Display Duration" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <Grid ColumnDefinitions="Auto * Auto" ColumnSpacing="8">
                                <TextBlock Grid.Column="0" 
                                           Text="Duration (seconds):" 
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Grid.Column="1"
                                               x:Name="PhotoDisplayDurationNumericUpDown"
                                               Value="{Binding PhotoDisplayDurationSeconds}"
                                               Minimum="1"
                                               Maximum="3600"
                                               FormatString="0"
                                               Increment="1"
                                               ShowButtonSpinner="True"
                                               HorizontalAlignment="Left"
                                               Width="150"/>
                                <TextBlock Grid.Column="2"
                                           Text="(1-3600)"
                                           VerticalAlignment="Center"
                                           Foreground="Gray"
                                           FontSize="12"/>
                            </Grid>
                        </StackPanel>

                        <!-- Image Scaling Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Image Scaling" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <RadioButton Content="No scaling (full resolution)"
                                         GroupName="ImageScaling"
                                         IsChecked="{Binding ImageScalingOff}"/>
                            <RadioButton Content="Auto (based on screen size)"
                                         GroupName="ImageScaling"
                                         IsChecked="{Binding ImageScalingAuto}"/>
                            <RadioButton Content="Fixed maximum"
                                         GroupName="ImageScaling"
                                         IsChecked="{Binding ImageScalingFixed}"/>
                            
                            <!-- Fixed maximum dimensions (only enabled when Fixed is selected) -->
                            <Grid ColumnDefinitions="Auto * Auto *" 
                                  ColumnSpacing="8"
                                  Margin="20,4,0,0"
                                  IsEnabled="{Binding ImageScalingFixed}">
                                <TextBlock Grid.Column="0" 
                                           Text="Max width:" 
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Grid.Column="1"
                                               x:Name="FixedImageMaxWidthNumericUpDown"
                                               Value="{Binding FixedImageMaxWidth}"
                                               Minimum="100"
                                               Maximum="16384"
                                               FormatString="0"
                                               Increment="100"
                                               ShowButtonSpinner="True"
                                               HorizontalAlignment="Left"
                                               Width="120"/>
                                <TextBlock Grid.Column="2" 
                                           Text="Max height:" 
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0"/>
                                <NumericUpDown Grid.Column="3"
                                               x:Name="FixedImageMaxHeightNumericUpDown"
                                               Value="{Binding FixedImageMaxHeight}"
                                               Minimum="100"
                                               Maximum="16384"
                                               FormatString="0"
                                               Increment="100"
                                               ShowButtonSpinner="True"
                                               HorizontalAlignment="Left"
                                               Width="120"/>
                            </Grid>
                        </StackPanel>

                        <!-- Missing File Behavior Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Missing File Behavior" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <RadioButton Content="Always show dialog"
                                         GroupName="MissingFileBehavior"
                                         IsChecked="{Binding MissingFileBehaviorAlwaysShowDialog}"/>
                            <RadioButton Content="Always remove from library"
                                         GroupName="MissingFileBehavior"
                                         IsChecked="{Binding MissingFileBehaviorAlwaysRemoveFromLibrary}"/>
                        </StackPanel>
                        
                        <!-- Seek Step Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Seek Step" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <RadioButton Content="Frame (Shift + arrow keys)"
                                         GroupName="SeekStep"
                                         IsChecked="{Binding SeekStepFrame}"/>
                            <RadioButton Content="1 second"
                                         GroupName="SeekStep"
                                         IsChecked="{Binding SeekStep1s}"/>
                            <RadioButton Content="5 seconds"
                                         GroupName="SeekStep"
                                         IsChecked="{Binding SeekStep5s}"/>
                            <RadioButton Content="10 seconds"
                                         GroupName="SeekStep"
                                         IsChecked="{Binding SeekStep10s}"/>
                        </StackPanel>
                        
                        <!-- Volume Step Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Volume Step" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <RadioButton Content="1%"
                                         GroupName="VolumeStep"
                                         IsChecked="{Binding VolumeStep1}"/>
                            <RadioButton Content="2%"
                                         GroupName="VolumeStep"
                                         IsChecked="{Binding VolumeStep2}"/>
                            <RadioButton Content="5%"
                                         GroupName="VolumeStep"
                                         IsChecked="{Binding VolumeStep5}"/>
                        </StackPanel>
                        
                        <!-- Volume Normalization Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Volume Normalization" 
                                       FontWeight="SemiBold" 
                                       FontSize="13"
                                       Margin="0,0,0,4"/>
                            <CheckBox x:Name="NormalizationEnabledCheckBox"
                                      Content="Enable volume normalization"
                                      IsChecked="{Binding VolumeNormalizationEnabled}"/>
                            <TextBlock Text="Reduces loud videos to match quieter ones in your library. Run 'Library > Scan Loudness' first for best results."
                                       FontSize="11"
                                       Foreground="Gray"
                                       TextWrapping="Wrap"
                                       Margin="20,4,0,0"/>
                            
                            <!-- Advanced normalization settings -->
                            <StackPanel Margin="20,8,0,0"
                                        IsEnabled="{Binding VolumeNormalizationEnabled}">
                                <TextBlock Text="Advanced Settings"
                                           FontWeight="SemiBold"
                                           FontSize="12"
                                           Margin="0,0,0,4"/>
                                
                                <!-- Max Reduction -->
                                <Grid Margin="0,4,0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Max Reduction (dB):"
                                               VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Column="1"
                                                   Value="{Binding MaxReductionDb, Mode=TwoWay}"
                                                   Minimum="1"
                                                   Maximum="30"
                                                   Increment="1"
                                                   FormatString="0"
                                                   ShowButtonSpinner="True"/>
                                    <TextBlock Grid.Column="2"
                                               Text="Maximum volume reduction for loud videos"
                                               FontSize="11"
                                               Foreground="Gray"
                                               VerticalAlignment="Center"
                                               Margin="8,0,0,0"/>
                                </Grid>
                                
                                <!-- Max Boost -->
                                <Grid Margin="0,4,0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Max Boost (dB):"
                                               VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Column="1"
                                                   Value="{Binding MaxBoostDb, Mode=TwoWay}"
                                                   Minimum="0"
                                                   Maximum="10"
                                                   Increment="1"
                                                   FormatString="0"
                                                   ShowButtonSpinner="True"/>
                                    <TextBlock Grid.Column="2"
                                               Text="Maximum volume boost for quiet videos"
                                               FontSize="11"
                                               Foreground="Gray"
                                               VerticalAlignment="Center"
                                               Margin="8,0,0,0"/>
                                </Grid>
                                
                                <!-- Baseline Mode -->
                                <TextBlock Text="Baseline Loudness:"
                                           FontWeight="SemiBold"
                                           FontSize="11"
                                           Margin="0,8,0,4"/>
                                <RadioButton Content="Automatic (75th percentile of library)"
                                             GroupName="BaselineMode"
                                             IsChecked="{Binding BaselineAutoMode}"/>
                                <RadioButton Content="Manual override"
                                             GroupName="BaselineMode"
                                             IsChecked="{Binding BaselineManualMode}"
                                             Margin="0,4,0,0"/>
                                
                                <!-- Baseline Override Value -->
                                <Grid Margin="20,4,0,0"
                                      IsEnabled="{Binding BaselineManualMode}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Target Baseline (LUFS):"
                                               VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Column="1"
                                                   Value="{Binding BaselineOverrideLUFS, Mode=TwoWay}"
                                                   Minimum="-50"
                                                   Maximum="-10"
                                                   Increment="0.5"
                                                   FormatString="0.0"
                                                   ShowButtonSpinner="True"/>
                                    <TextBlock Grid.Column="2"
                                               Text="EBU R128 recommends -23 LUFS"
                                               FontSize="11"
                                               Foreground="Gray"
                                               VerticalAlignment="Center"
                                               Margin="8,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Spacing="8">
            <Button Content="Apply"
                    Click="ApplyButton_Click"
                    MinWidth="100"/>
            <Button Content="OK"
                    Click="OKButton_Click"
                    MinWidth="100"
                    IsDefault="True"/>
            <Button Content="Cancel"
                    Click="CancelButton_Click"
                    MinWidth="100"/>
        </StackPanel>
    </Grid>
</Window>

